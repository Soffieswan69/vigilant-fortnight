<!DOCTYPE html>
<html>
  <head>
    <title>Remove unused code</title>
    <meta name="description" content="In this codelab, learn how to improve the performance of an application by
removing any unused and unneeded dependencies.
" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="robots" content="noindex">
    <meta charset="utf-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="full_width" value="true" />
    <link rel="preconnect" href="//www.gstatic.com" crossorigin="" />
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin="" />
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin="" />
    <link
      rel="stylesheet"
      href="//fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic|Roboto+Condensed:400,700|Roboto+Mono:400,500|Material+Icons"
    />
    <link
      rel="stylesheet"
      href="/all.css"
    />
    <script type="module" src="confboxScript(/site/_includes/lib/app.mjs)"></script>
  </head>
  <body>
    <devsite-header
  ds-is="header"
  no-lower-row=""
  top-row--height="64"
  bottom-row--height="0"
  bottom-tabs--height="0"
  bottom-row--hidden=""
  fixed=""
  style="opacity: 1;"
>
  <div class="devsite-header--inner">
    <div class="devsite-top-logo-row-wrapper-wrapper">
      <div class="devsite-top-logo-row-wrapper">
        <div class="devsite-top-logo-row">
          <button
            type="button"
            id="devsite-hamburger-menu"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Navigation menu button"
            aria-label="Close menu"
          ></button>
          <div class="devsite-product-name-wrapper">
            <a
              href="/"
              class="devsite-site-logo-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Site logo"
            >
              <img
                src="/images/lockup.svg"
                class="devsite-site-logo"
                alt="web.dev"
              />
            </a>
          </div>
          <div class="devsite-top-logo-row-middle">
            <div class="devsite-header-upper-tabs">
              <devsite-tabs ds-is="tabs" class="upper-tabs" connected="">
                <div class="devsite-tabs-wrapper">
                  <tab>
                    <a
                      href="/learn"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Learn"
                    >
                      Learn
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/measure"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Measure"
                    >
                      Measure
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/blog"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Blog"
                    >
                      Blog
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/about"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: About"
                    >
                      About
                    </a>
                  </tab>
                  <tab overflow-tab="" hidden=""
                    ><a
                      href="/fast/use-imagemin-to-compress-images#"
                      class="devsite-icon devsite-icon-arrow-drop-down"
                      >More</a
                    >
                    <div
                      class="devsite-tabs-overflow-menu"
                      scrollbars=""
                      hidden=""
                    ></div
                  ></tab></div
              ></devsite-tabs>
            </div>
            <devsite-search
              ds-is="search"
              enable-search=""
              enable-signin=""
              enable-suggestions=""
              enable-query-completion=""
              enable-product-suggestions=""
              enable-title-suggestions=""
              enable-reference-suggestions=""
              project-path=""
            >
              <form
                class="devsite-search-form"
                action="/results/"
                method="GET"
              >
                <div class="devsite-search-container">
                  <div id="searchbox" class="devsite-searchbox">
                    <input
                      placeholder="Search"
                      type="text"
                      class="devsite-search-field devsite-search-query"
                      name="q"
                      value=""
                      autocomplete="off"
                      aria-label="Search box"
                    />
                    <div
                      class="devsite-search-image material-icons"
                    ></div>
                  </div>
                  <button
                    type="button"
                    search-open=""
                    class="devsite-search-button devsite-header-icon-button button-flat material-icons"
                    aria-label="Open search box"
                  ></button>
                </div>
                <div class="devsite-popout">
                  <div
                    class="devsite-popout-result devsite-suggest-results-container"
                    devsite-hide=""
                    role="menu"
                    aria-haspopup="true"
                  >
                    <div class="devsite-suggest-wrapper">
                      <div class="devsite-suggest-section">
                        <div class="devsite-suggest-header">
                          Suggested searches
                        </div>
                        <devsite-analytics-scope
                          category="Site-Wide Custom Events"
                          label="Search"
                          action="Query Suggestion Click"
                          ds-is="analytics-scope"
                          ><div
                            class="devsite-result-item devsite-nav-label"
                            role="menuitem"
                            index=":0"
                          >
                            <a
                              class="devsite-result-item-link"
                              href="/results/?q=api"
                              ><span class="devsite-suggestion-fragment"
                                ><b></b>a<b></b>p<b></b>i<b></b></span
                            ></a>
                          </div>
                          <devsite-analytics-scope
                            category="Site-Wide Custom Events"
                            label="Search"
                            action="Query Suggestion Click"
                            ds-is="analytics-scope"
                            ><div
                              class="devsite-result-item devsite-nav-label"
                              role="menuitem"
                              index=":1"
                            >
                              <a
                                class="devsite-result-item-link"
                                href="/results/?q=google"
                                ><span class="devsite-suggestion-fragment"
                                  ><b></b>g<b></b>o<b></b>o<b></b>g<b
                                  ></b>l<b></b>e<b></b></span
                              ></a>
                            </div>
                            <devsite-analytics-scope
                              category="Site-Wide Custom Events"
                              label="Search"
                              action="Query Suggestion Click"
                              ds-is="analytics-scope"
                              ><div
                                class="devsite-result-item devsite-nav-label"
                                role="menuitem"
                                index=":2"
                              >
                                <a
                                  class="devsite-result-item-link"
                                  href="/results/?q=developers"
                                  ><span
                                    class="devsite-suggestion-fragment"
                                    ><b></b>d<b></b>e<b></b>v<b></b>e<b
                                    ></b>l<b></b>o<b></b>p<b></b>e<b
                                    ></b>r<b></b>s<b></b></span
                                ></a>
                              </div>
                              <devsite-analytics-scope
                                category="Site-Wide Custom Events"
                                label="Search"
                                action="Query Suggestion Click"
                                ds-is="analytics-scope"
                                ><div
                                  class="devsite-result-item devsite-nav-label"
                                  role="menuitem"
                                  index=":3"
                                >
                                  <a
                                    class="devsite-result-item-link"
                                    href="/results/?q=cloud"
                                    ><span
                                      class="devsite-suggestion-fragment"
                                      ><b></b>c<b></b>l<b></b>o<b></b>u<b
                                      ></b>d<b></b></span
                                  ></a>
                                </div>
                                <devsite-analytics-scope
                                  category="Site-Wide Custom Events"
                                  label="Search"
                                  action="Query Suggestion Click"
                                  ds-is="analytics-scope"
                                  ><div
                                    class="devsite-result-item devsite-nav-label"
                                    role="menuitem"
                                    index=":4"
                                  >
                                    <a
                                      class="devsite-result-item-link"
                                      href="/results/?q=site"
                                      ><span
                                        class="devsite-suggestion-fragment"
                                        ><b></b>s<b></b>i<b></b>t<b
                                        ></b>e<b></b></span
                                    ></a></div></devsite-analytics-scope></devsite-analytics-scope></devsite-analytics-scope></devsite-analytics-scope
                        ></devsite-analytics-scope>
                      </div>
                      <div class="devsite-suggest-footer">
                        <button
                          type="submit"
                          class="button button-white devsite-suggest-all-results"
                        >
                          See all results for ""
                        </button>
                      </div>
                    </div>
                  </div>
                  <div
                    class="devsite-popout-result devsite-history-container"
                    devsite-hide=""
                    role="menu"
                    aria-haspopup="true"
                  ></div>
                </div>
              </form>
              <button
                type="button"
                search-close=""
                class="devsite-search-button devsite-header-icon-button button-flat material-icons"
                aria-label="Close search box"
              ></button>
            </devsite-search>

            <devsite-search-background
              style="opacity: 1;"
            ></devsite-search-background>
          </div>

          <devsite-user
            ds-is="user"
            sign-in-url="https://web.dev/_d/signin?continue=https%3A%2F%2Fweb.dev%2Ffast%2Fuse-imagemin-to-compress-images"
            ><div class="ogb-wrapper ogb-si">
              <a
                href="https://web.dev/_d/signin?continue=https%3A%2F%2Fweb.dev%2Ffast%2Fuse-imagemin-to-compress-images"
                class="devsite-user-signin button devsite-top-button"
              >
                Sign in
              </a>
            </div></devsite-user
          >
        </div>
      </div>
    </div>
    <div
      class="devsite-collapsible-section
      devsite-header-no-lower-tabs
"
    >
      <div class="devsite-header-background"></div>
    </div>
  </div>
</devsite-header>
    <main>
      <div id="content">
        


<style>
  web-codelab {
    display: flex;
    height: 100%;
  }

  .web-codelab-glitch {
    flex: 1;
    padding: 16px;
  }
</style>


<div class="codelab-landing-page">
  <web-codelab glitch="fav-kitties-starter" path="[object Object]" preview-size="" attribution-hidden>
    <div class="web-codelab-instructions">
      <h1 class="w-headline w-headline--two w-mb--sm">Remove unused code</h1>
      
        <div class="w-author__published">
          <time>Nov 5, 2018</time>
          
        </div>
      

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <img
    class="w-author__image "
    src="/images/authors/houssein.jpg"
    alt="Houssein Djirdeh"
  />
  <div class="w-author__info" style="display: flex; flex-direction: column; justify-content: center;">
    <cite class="w-author__name">Houssein Djirdeh</cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/hdjirdeh">Twitter</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/housseindjirdeh">GitHub</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://glitch.com/@housseindjirdeh">Glitch</a>
      </li>
    </ul>
  </div>
</div>
          
        </div>
      

      <p>In this codelab, improve the performance of the following application by
removing any unused and unneeded dependencies.</p>
<p><img src="./kitties.png" alt="App screenshot"></p>
<h2 id="measure">Measure <a class="w-headline-link" href="#measure" aria-hidden="true">#</a></h2>
<div class="w-aside w-aside--note">
<p>Since webpack is used in this application, any changes made to the code will
trigger a new build which can take a few seconds. Once it completes, you
should see your changes reflected in the application.</p>
</div>
<p>It's always a good idea to first measure how well a website performs before
adding optimizations.</p>
<ul>
<li>To preview the site, mouse over the editor, press the <strong>App</strong> button, then the
<strong>Show</strong> button.</li>
</ul>
<p>Go ahead and click on your favorite kitten! Firebase's
<a href="https://firebase.google.com/products/realtime-database/">Realtime Database</a> is
used in this application which is why the score updates in real-time and is
synchronized with every other person using the application. 🐈</p>
<ul>
<li>Open the DevTools by pressing <code>CMD + OPTION + i</code> / <code>CTRL + SHIFT + i</code>.</li>
<li>Click on the <strong>Network</strong> tab.</li>
</ul>
<img class="w-screenshot" src="./network.png" alt="Network tab">
<p>Make sure <code>Disable Cache</code> is checked and reload the app.</p>
<img class="w-screenshot" src="./main-bundle.png" alt="Original bundle size of 992 KB">
<p>Almost 1 MB worth of JavaScript is being shipped to load this simple application!</p>
<p>Take a look at the project warnings in DevTools.</p>
<ul>
<li>Click on the <strong>Console</strong> tab.</li>
<li>Make sure that <code>Warnings</code> is enabled in the levels dropdown next to the
<code>Filter</code> input.</li>
</ul>
<img class="screenshot" src="./warnings.png" alt="Warnings filter">
<ul>
<li>Take a look at the displayed warning.</li>
</ul>
<img class="screenshot" src="./displayed-warning.png" alt="Console warning">
<p>Firebase, which is one of the libraries used in this application, is being a
good samaritan by providing a warning to let developers know to not import its
entire package but only the components that are used. In other words, there are
unused libraries that can be removed in this application to make it load
faster.</p>
<p>There are also instances when a particular library is used, but where there may be
a simpler alternative. The concept of removing <strong>unneeded libraries</strong> is
explored later in this tutorial.</p>
<h2 id="analyzing-the-bundle">Analyzing the bundle <a class="w-headline-link" href="#analyzing-the-bundle" aria-hidden="true">#</a></h2>
<p>There are two main dependencies in the application:</p>
<ul>
<li><a href="https://firebase.google.com/">Firebase</a>: a platform that provides a number of
useful services for iOS, Android or web applications. Here its <a href="https://firebase.google.com/products/realtime-database/">Realtime
Database</a> is used to
store and sync the information for each kitten in real time.</li>
<li><a href="https://momentjs.com/">Moment.js</a>: a utility library that makes it easier to
handle dates in JavaScript. The birth date of each kitten is stored in the
Firebase database, and <code>moment</code> is used to calculate its age in weeks.</li>
</ul>
<p>How can just two dependencies contribute to a bundle size of almost 1 MB? Well,
one of the reasons is that any dependency can in turn have their own
dependencies, so there are a lot more than just two if every depth/branch of the
dependency &quot;tree&quot; is considered. It's easy for an application to become large
relatively quickly if many dependencies are included.</p>
<p>Analyze the bundler to get a better idea of what is going. There are a number of
different community-built tools that can help do this, such as
<a href="https://www.npmjs.com/package/webpack-bundle-analyzer"><code>webpack-bundle-analyzer</code></a>.</p>
<p>The package for this tool is already included in the app as a <code>devDependency</code>.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">//...</span></span><br><span class="highlight-line">  <span class="token string">"webpack-bundle-analyzer"</span><span class="token punctuation">:</span> <span class="token string">"^2.13.1"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span></code></pre>
<p>This means that it can be used directly in the webpack configuration file.
Import it at the very beginning of <code>webpack.config.js</code>:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">//...</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"webpack-bundle-analyzer"</span><span class="token punctuation">)</span></mark><br><span class="highlight-line">  <span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span></span></code></pre>
<p>Now add it as a plugin at the very end of the file within the <code>plugins</code> array:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">//...</span></span><br><span class="highlight-line">  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">    <span class="token comment">//...</span></span><br><mark class="highlight-line highlight-line-active">    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span></mark><br><span class="highlight-line">  <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p>When the application reloads, you should see a visualization of the entire
bundle instead of the app itself.</p>
<p><img src="./bundle-visualization.png" alt="Webpack Bundle Analyzer"></p>
<p>Not as cute as seeing some kittens 🐱, but incredibly helpful nonetheless.
Hovering over any of the packages shows its size represented in three
different ways:</p>
<div class="w-table-wrapper">
  <table>
    <thead>
      <tr>
        <th><strong>Stat size</strong></th>
        <th>Size before any minification or compression.</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Parsed size</strong></td>
        <td>
          Size of actual package within the bundle after it has been compiled.
          Version 4 of webpack (which is used in this application) minifies the
          compiled files automatically which is why this is smaller than the stat
          size.
        </td>
      </tr>
      <tr>
        <td><strong>Gzipped size</strong></td>
        <td>
          Size of package after it has been compressed with gzip encoding. This
          topic is covered in a separate guide.
        </td>
      </tr>
    </tbody>
  </table>
</div>
<p>With the webpack-bundle-analyzer tool, it is easier to identify unused or
unneeded packages that make up a large percentage of the bundle.</p>
<h2 id="removing-unused-packages">Removing unused packages <a class="w-headline-link" href="#removing-unused-packages" aria-hidden="true">#</a></h2>
<p>The visualization shows that the <code>firebase</code> package consists of a <em>lot</em> more
than just a database. It includes additional packages such as:</p>
<ul>
<li><code>firestore</code></li>
<li><code>auth</code></li>
<li><code>storage</code></li>
<li><code>messaging</code></li>
<li><code>functions</code></li>
</ul>
<p>These are all amazing services provided by Firebase (and refer to the
<a href="https://firebase.google.com/docs/web/setup#use_firebase_services">documentation</a>
to learn more), but none of them are being used in the application, so there's
no reason to have them all imported.</p>
<p>Revert the changes in <code>webpack.config.js</code> to see the application again:</p>
<ul>
<li>Remove <code>BundleAnalyzerPlugin</code> in the list of plugins:</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="highlight-line">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token comment">//...</span></span><br><del class="highlight-line highlight-line-remove">  <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span></del><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span></code></pre>
<ul>
<li>And now remove the unused import from the top of the file:</li>
</ul>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">//...</span></span><br><del class="highlight-line highlight-line-remove"><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span></del></code></pre>
<p>The application should load normally now. Modify <code>src/index.js</code> to update the
Firebase imports.</p>
<pre class="language-js"><code class="language-js"><del class="highlight-line highlight-line-remove"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">'firebase'</span><span class="token punctuation">;</span></del><br><ins class="highlight-line highlight-line-add"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">'firebase/app'</span><span class="token punctuation">;</span></ins><br><ins class="highlight-line highlight-line-add"><span class="token keyword">import</span> <span class="token string">'firebase/database'</span><span class="token punctuation">;</span></ins></code></pre>
<p>Now when the app reloads, the DevTools warning does not show. Opening the
DevTools <strong>Network</strong> panel also shows a <em>nice</em> reduction in bundle size:</p>
<img class="screenshot" src="./reduced-main-bundle.png" alt="Bundle size reduced to 480 KB">
<p>More than half the bundle size was removed. Firebase provides many different
services and gives developers the option to only include those that are actually
needed. In this application, only <code>firebase/database</code> was used to store and sync
all of the data. The <code>firebase/app</code> import, which sets up the API surface for
each of the different services, is always required.</p>
<p>Many other popular libraries, such as <code>lodash</code>, also allow developers to
selectively import different parts of their packages. Without doing much work,
updating library imports in an application to only include what is being used
can result in significant performance improvements.</p>
<p>Although the bundle size has been reduced by quite a bit, there's still more
work to do! 😈</p>
<h2 id="removing-unneeded-packages">Removing unneeded packages <a class="w-headline-link" href="#removing-unneeded-packages" aria-hidden="true">#</a></h2>
<p>Unlike Firebase, importing parts of the <code>moment</code> library cannot be done as
easily, but maybe it can be removed entirely?</p>
<p>The birthday of each cute kitten is stored in <strong>Unix</strong> format (milliseconds) in
the Firebase database.</p>
<img class="screenshot" src="./kitty-birthdays.png" alt="Birthdates stored in Unix format">
<p>This is a timestamp of a particular date and time represented by the number of
milliseconds that have elapsed since January 1, 1970 00:00 UTC. If the current
date and time can be calculated in the same format, a small function to find the
age of each kitten in weeks can probably be constructed.</p>
<p>Like always, try not to copy and paste as you follow along here. Begin by
removing <code>moment</code> from the imports in <code>src/index.js</code>.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> firebase <span class="token keyword">from</span> <span class="token string">'firebase/app'</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token string">'firebase/database'</span><span class="token punctuation">;</span></span><br><del class="highlight-line highlight-line-remove"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span><span class="token punctuation">;</span></del></code></pre>
<p>There is a Firebase event listener that handles value changes in our database:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line">favoritesRef<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">snapshot</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></code></pre>
<p>Above this, add a small function to calculate the number of weeks from a
given date:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">ageInWeeks</span> <span class="token operator">=</span> <span class="token parameter">birthDate</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> <span class="token constant">WEEK_IN_MILLISECONDS</span> <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> diff <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> birthDate<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> <span class="token constant">WEEK_IN_MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>In this function, the difference in milliseconds between the current date and
time <code>(new Date).getTime()</code> and the birth date (the <code>birthDate</code> argument, already
in milliseconds) is calculated and divided by the number of milliseconds in a
single week.</p>
<p>Finally, all instances of <code>moment</code> can be removed in the event listener by
leveraging this function instead:</p>
<pre>
favoritesRef.on("value", (snapshot) => {
  const { kitties, favorites, names, birthDates } = snapshot.val();
  favoritesScores = favorites;

  kittiesList.innerHTML = kitties.map((kittiePic, index) => {
    <s>const birthday = moment(birthDates[index]);</s>

    return `
      &lt;li&gt;
        &lt;img src=${kittiePic} onclick=&quot;favKittie(${index})&quot;&gt;
        &lt;div class=&quot;extra&quot;&gt;
          &lt;div class=&quot;details&quot;&gt;
            &lt;p class=&quot;name&quot;&gt;${names[index]}&lt;/p&gt;
            <s>&lt;p class=&quot;age&quot;&gt;${moment().diff(birthday, 'weeks')} weeks old&lt;/p&gt;</s>
            <strong>&lt;p class=&quot;age&quot;&gt;${ageInWeeks(birthDates[index])} weeks old&lt;/p&gt;</strong>
          &lt;/div&gt;
          &lt;p class=&quot;score&quot;&gt;${favorites[index]} ❤&lt;/p&gt;
        &lt;/div&gt;
      &lt;/li&gt;
    `})
});
</pre>
<p>Now reload the application and take a look at the <strong>Network</strong> panel once more.</p>
<img class="screenshot" src="./smallest-bundle.png" alt="Bundle size reduced to 225 KB">
<p>The size of our bundle was reduced by more than half again!</p>
<h2 id="conclusion">Conclusion <a class="w-headline-link" href="#conclusion" aria-hidden="true">#</a></h2>
<p>With this codelab, you should have a decent understanding of how to analyze a
particular bundle and why it can be so useful to remove unused or unneeded
packages. Before you begin optimizing an application with this technique, <strong>it's
important to know that this can be significantly more complex in larger
applications</strong>.</p>
<p>With regards to <strong>removing unused libraries</strong>, try to find out which parts of a
bundle are being used and which parts are not. For a mysterious looking
package that looks like it is not being used anywhere, take a step back and check
which top-level dependencies might need it. Try to find a way to possibly
decouple them from each other.</p>
<p>When it comes to <strong>removing unneeded libraries</strong>, things can be a little more
complicated. It's important to work closely with your team and see if there is
potential to simplify parts of the codebase. Removing <code>moment</code> in this
application may look like it would be the right thing to do every time, but what
if there were time zones and different locales that needed to be handled? Or
what if there were more complicated date manipulations? Things can get very
tricky when manipulating and parsing dates/times, and libraries like <code>moment</code>
and <a href="https://date-fns.org/"><code>date-fns</code></a> simplify this significantly.</p>
<p><strong>Everything is a tradeoff, and it's important to gauge whether it's even worth
the complexity and effort to roll out a custom solution instead of relying on a
third-party library.</strong></p>

      
        <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back w-article-navigation__link--single gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/remove-unused-code"
  >
    Return to article
  </a>
  
</nav>
      
    </div>

    
    
      <div class="web-codelab-glitch">
        <div class="glitch-embed-wrap" style="height: 100%; width: 100%;">
          <iframe
            allow="geolocation; microphone; camera; midi; encrypted-media"
            src="https://glitch.com/embed/#!/embed/fav-kitties-starter?path=[object Object]&amp;previewSize="
            alt="fav-kitties-starter on Glitch"
            style="height: 100%; width: 100%; border: 0;"
          >
          </iframe>
        </div>
      </div>
    

  </web-codelab>
</div>

      </div>
    </main>
  </body>
</html>