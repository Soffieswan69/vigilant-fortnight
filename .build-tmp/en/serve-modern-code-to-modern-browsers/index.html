<!DOCTYPE html>
<html>
  <head>
    <title>Serve modern code to modern browsers for faster page loads</title>
    <meta name="description" content="Building websites that work well on all major browsers is a core tenet of an
open web ecosystem. However, this means additional work of ensuring that all
of the code you write is supported in each browser that you plan to target. If
you want to use new JavaScript language features, you need to transpile these
features to backwards-compatible formats.  
" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="robots" content="noindex">
    <meta charset="utf-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="full_width" value="true" />
    <link rel="preconnect" href="//www.gstatic.com" crossorigin="" />
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin="" />
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin="" />
    <link
      rel="stylesheet"
      href="//fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic|Roboto+Condensed:400,700|Roboto+Mono:400,500|Material+Icons"
    />
    <link
      rel="stylesheet"
      href="/all.css"
    />
    <script type="module" src="confboxScript(/site/_includes/lib/app.mjs)"></script>
  </head>
  <body>
    <devsite-header
  ds-is="header"
  no-lower-row=""
  top-row--height="64"
  bottom-row--height="0"
  bottom-tabs--height="0"
  bottom-row--hidden=""
  fixed=""
  style="opacity: 1;"
>
  <div class="devsite-header--inner">
    <div class="devsite-top-logo-row-wrapper-wrapper">
      <div class="devsite-top-logo-row-wrapper">
        <div class="devsite-top-logo-row">
          <button
            type="button"
            id="devsite-hamburger-menu"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Navigation menu button"
            aria-label="Close menu"
          ></button>
          <div class="devsite-product-name-wrapper">
            <a
              href="/"
              class="devsite-site-logo-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Site logo"
            >
              <img
                src="/images/lockup.svg"
                class="devsite-site-logo"
                alt="web.dev"
              />
            </a>
          </div>
          <div class="devsite-top-logo-row-middle">
            <div class="devsite-header-upper-tabs">
              <devsite-tabs ds-is="tabs" class="upper-tabs" connected="">
                <div class="devsite-tabs-wrapper">
                  <tab>
                    <a
                      href="/learn"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Learn"
                    >
                      Learn
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/measure"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Measure"
                    >
                      Measure
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/blog"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: Blog"
                    >
                      Blog
                    </a>
                  </tab>
                  <tab>
                    <a
                      href="/about"
                      class="gc-analytics-event"
                      data-category="Site-Wide Custom Events"
                      data-label="Tab: About"
                    >
                      About
                    </a>
                  </tab>
                  <tab overflow-tab="" hidden=""
                    ><a
                      href="/fast/use-imagemin-to-compress-images#"
                      class="devsite-icon devsite-icon-arrow-drop-down"
                      >More</a
                    >
                    <div
                      class="devsite-tabs-overflow-menu"
                      scrollbars=""
                      hidden=""
                    ></div
                  ></tab></div
              ></devsite-tabs>
            </div>
            <devsite-search
              ds-is="search"
              enable-search=""
              enable-signin=""
              enable-suggestions=""
              enable-query-completion=""
              enable-product-suggestions=""
              enable-title-suggestions=""
              enable-reference-suggestions=""
              project-path=""
            >
              <form
                class="devsite-search-form"
                action="/results/"
                method="GET"
              >
                <div class="devsite-search-container">
                  <div id="searchbox" class="devsite-searchbox">
                    <input
                      placeholder="Search"
                      type="text"
                      class="devsite-search-field devsite-search-query"
                      name="q"
                      value=""
                      autocomplete="off"
                      aria-label="Search box"
                    />
                    <div
                      class="devsite-search-image material-icons"
                    ></div>
                  </div>
                  <button
                    type="button"
                    search-open=""
                    class="devsite-search-button devsite-header-icon-button button-flat material-icons"
                    aria-label="Open search box"
                  ></button>
                </div>
                <div class="devsite-popout">
                  <div
                    class="devsite-popout-result devsite-suggest-results-container"
                    devsite-hide=""
                    role="menu"
                    aria-haspopup="true"
                  >
                    <div class="devsite-suggest-wrapper">
                      <div class="devsite-suggest-section">
                        <div class="devsite-suggest-header">
                          Suggested searches
                        </div>
                        <devsite-analytics-scope
                          category="Site-Wide Custom Events"
                          label="Search"
                          action="Query Suggestion Click"
                          ds-is="analytics-scope"
                          ><div
                            class="devsite-result-item devsite-nav-label"
                            role="menuitem"
                            index=":0"
                          >
                            <a
                              class="devsite-result-item-link"
                              href="/results/?q=api"
                              ><span class="devsite-suggestion-fragment"
                                ><b></b>a<b></b>p<b></b>i<b></b></span
                            ></a>
                          </div>
                          <devsite-analytics-scope
                            category="Site-Wide Custom Events"
                            label="Search"
                            action="Query Suggestion Click"
                            ds-is="analytics-scope"
                            ><div
                              class="devsite-result-item devsite-nav-label"
                              role="menuitem"
                              index=":1"
                            >
                              <a
                                class="devsite-result-item-link"
                                href="/results/?q=google"
                                ><span class="devsite-suggestion-fragment"
                                  ><b></b>g<b></b>o<b></b>o<b></b>g<b
                                  ></b>l<b></b>e<b></b></span
                              ></a>
                            </div>
                            <devsite-analytics-scope
                              category="Site-Wide Custom Events"
                              label="Search"
                              action="Query Suggestion Click"
                              ds-is="analytics-scope"
                              ><div
                                class="devsite-result-item devsite-nav-label"
                                role="menuitem"
                                index=":2"
                              >
                                <a
                                  class="devsite-result-item-link"
                                  href="/results/?q=developers"
                                  ><span
                                    class="devsite-suggestion-fragment"
                                    ><b></b>d<b></b>e<b></b>v<b></b>e<b
                                    ></b>l<b></b>o<b></b>p<b></b>e<b
                                    ></b>r<b></b>s<b></b></span
                                ></a>
                              </div>
                              <devsite-analytics-scope
                                category="Site-Wide Custom Events"
                                label="Search"
                                action="Query Suggestion Click"
                                ds-is="analytics-scope"
                                ><div
                                  class="devsite-result-item devsite-nav-label"
                                  role="menuitem"
                                  index=":3"
                                >
                                  <a
                                    class="devsite-result-item-link"
                                    href="/results/?q=cloud"
                                    ><span
                                      class="devsite-suggestion-fragment"
                                      ><b></b>c<b></b>l<b></b>o<b></b>u<b
                                      ></b>d<b></b></span
                                  ></a>
                                </div>
                                <devsite-analytics-scope
                                  category="Site-Wide Custom Events"
                                  label="Search"
                                  action="Query Suggestion Click"
                                  ds-is="analytics-scope"
                                  ><div
                                    class="devsite-result-item devsite-nav-label"
                                    role="menuitem"
                                    index=":4"
                                  >
                                    <a
                                      class="devsite-result-item-link"
                                      href="/results/?q=site"
                                      ><span
                                        class="devsite-suggestion-fragment"
                                        ><b></b>s<b></b>i<b></b>t<b
                                        ></b>e<b></b></span
                                    ></a></div></devsite-analytics-scope></devsite-analytics-scope></devsite-analytics-scope></devsite-analytics-scope
                        ></devsite-analytics-scope>
                      </div>
                      <div class="devsite-suggest-footer">
                        <button
                          type="submit"
                          class="button button-white devsite-suggest-all-results"
                        >
                          See all results for ""
                        </button>
                      </div>
                    </div>
                  </div>
                  <div
                    class="devsite-popout-result devsite-history-container"
                    devsite-hide=""
                    role="menu"
                    aria-haspopup="true"
                  ></div>
                </div>
              </form>
              <button
                type="button"
                search-close=""
                class="devsite-search-button devsite-header-icon-button button-flat material-icons"
                aria-label="Close search box"
              ></button>
            </devsite-search>

            <devsite-search-background
              style="opacity: 1;"
            ></devsite-search-background>
          </div>

          <devsite-user
            ds-is="user"
            sign-in-url="https://web.dev/_d/signin?continue=https%3A%2F%2Fweb.dev%2Ffast%2Fuse-imagemin-to-compress-images"
            ><div class="ogb-wrapper ogb-si">
              <a
                href="https://web.dev/_d/signin?continue=https%3A%2F%2Fweb.dev%2Ffast%2Fuse-imagemin-to-compress-images"
                class="devsite-user-signin button devsite-top-button"
              >
                Sign in
              </a>
            </div></devsite-user
          >
        </div>
      </div>
    </div>
    <div
      class="devsite-collapsible-section
      devsite-header-no-lower-tabs
"
    >
      <div class="devsite-header-background"></div>
    </div>
  </div>
</devsite-header>
    <main>
      <div id="content">
        


<div class="guide-landing-page">
  

  
  <web-actions-controller page="post"></web-actions-controller>
  <div class="w-actions">     <a   class="w-actions__fab w-actions__fab--share"   href="https://twitter.com/share?text=Serve%20modern%20code%20to%20modern%20browsers%20for%20faster%20page%20loads&amp;url=https%3A%2F%2Fweb.dev%2Fserve-modern-code-to-modern-browsers%2F"   onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;" >   <span>Share</span> </a>     <a   class="w-actions__fab w-actions__fab--subscribe"   href="https://web.dev/subscribe" >   <span>Subscribe</span> </a>   </div>

  <div class="w-layout-container--narrow w-post-breadcrumbs">
    <ul class="w-breadcrumbs">
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link w-breadcrumbs__link--left-justify gc-analytics-event"
      data-category="web.dev"
      data-label="post, home breadcrumb"
      data-action="click"
      href="/"
    >
      Home
    </a>
  </li>
  <li class="w-breadcrumbs__crumb">
    <a
      class="w-breadcrumbs__link gc-analytics-event"
      data-category="web.dev"
      data-label="post, path breadcrumb"
      data-action="click"
      href=/fast
    >
      Fast load times
    </a>
  </li>
</ul>
  </div>

  <div class="w-layout-container--narrow w-post-content">
    <header class="w-article-header">
      <h1 class="w-article-header__headline">Serve modern code to modern browsers for faster page loads</h1>
      

      
        <div class="w-author__published">
          <time>Nov 5, 2018</time>
          
        </div>
      

      
        <div class="w-authors w-mt--xl w-pt--sm">
          
            <div class="w-author">
  <img
    class="w-author__image "
    src="/images/authors/houssein.jpg"
    alt="Houssein Djirdeh"
  />
  <div class="w-author__info" style="display: flex; flex-direction: column; justify-content: center;">
    <cite class="w-author__name">Houssein Djirdeh</cite>
    <ul class="w-author__link-list">
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://twitter.com/hdjirdeh">Twitter</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://github.com/housseindjirdeh">GitHub</a>
      </li>
      <li class="w-author__link-listitem">
        <a class="w-author__link" href="https://glitch.com/@housseindjirdeh">Glitch</a>
      </li>
    </ul>
  </div>
</div>
          
        </div>
      
    </header>
    <p>Building websites that work well on all major browsers is a core tenet of an
open web ecosystem. However, this means additional work of ensuring that all of
the code you write is supported in each browser that you plan to target. If you
want to use new JavaScript language features, you need to transpile these
features to backwards-compatible formats for browsers that do not yet support
them.</p>
<p><a href="https://babeljs.io/docs/en">Babel</a> is the most widely used tool to compile code
that contains newer syntax into code that different browsers and environments
(such as Node) can understand. This guide assumes you are using Babel, so you
need to follow the <a href="https://babeljs.io/setup">setup instructions</a> to
include it into your application if you haven't already. Select <code>webpack</code>
in <code>Build Systems</code> if you are using webpack as the module bundler in your app.</p>
<div class="w-aside w-aside--note">
<p>Fun fact: Lebab is a separate library that does the opposite of what Babel does.
It converts older code into newer syntax.</p>
</div>
<p>To use Babel to only transpile what is needed for your users, you
need to:</p>
<ol>
<li>Identify which browsers you want to target.</li>
<li>Use <code>@babel/preset-env</code> with appropriate browser targets.</li>
<li>Use <code>&lt;script type=&quot;module&quot;&gt;</code> to stop sending transpiled code to browsers that don't need it.</li>
</ol>
<h2 id="identify-which-browsers-you-want-to-target">Identify which browsers you want to target <a class="w-headline-link" href="#identify-which-browsers-you-want-to-target" aria-hidden="true">#</a></h2>
<p>Before you begin to modify how the code in your application is transpiled, you
need to identify which browsers access your application. Analyze which browsers
your users are currently using as well as those that you plan to target to make an
informed decision.</p>
<h2 id="use-@babelpreset-env">Use @babel/preset-env <a class="w-headline-link" href="#use-@babelpreset-env" aria-hidden="true">#</a></h2>
<p>Transpiling code usually results in a file that is larger than the
original larger file sizes than their original forms. By minimizing the amount of
compilation that you do you can reduce the size of your bundles to improve the
performance of a web page.</p>
<p>Instead of including specific plugins to selectively compile certain language
features you are using, Babel provides a number of presets that bundles plugins
together. Use <a href="https://babeljs.io/docs/en/babel-preset-env">@babel/preset-env</a>
to only include the transforms and polyfills needed for the browsers you plan on
targeting.</p>
<p>Include <code>@babel/preset-env</code> within the <code>presets</code> array in your Babel
configurations file, <code>.babelrc</code>:</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line"> <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">   <span class="token punctuation">[</span></span><br><span class="highlight-line">     <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">     <span class="token punctuation">{</span></span><br><span class="highlight-line">       <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token string">">0.25%"</span></span><br><span class="highlight-line">     <span class="token punctuation">}</span></span><br><span class="highlight-line">   <span class="token punctuation">]</span></span><br><span class="highlight-line"> <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Use the <code>targets</code> field to specify which browser versions you want to include,
by adding an appropriate value (or query) to the <code>browsers</code> field.
<code>@babel/preset-env</code> integrates with browserslist, an open-source configuration
shared between different tools for targeting browsers. A full list of compatible
queries is in the <a href="https://github.com/browserslist/browserslist#full-list">browserslist
documentation</a>. Another
option is to use a <code>.browserslistrc</code> file to list the environments you wish to
target.</p>
<p>Use the <code>targets</code> field to specify which browser versions you want to include
by adding an appropriate query to the <code>browsers</code> field. <code>@babel/preset-env</code>
integrates with browserslist, an open-source configuration shared between different
tools for targeting browsers. A full list of compatible queries is in the
<a href="https://github.com/browserslist/browserslist#full-list">browserslist documentation</a>.
Another option is to use a <a href="https://babeljs.io/docs/en/babel-preset-env#browserslist-integration"><code>.browserslistrc</code></a> file to list the environments
you wish to target.</p>
<p>The <code>&quot;&gt;0.25%&quot;</code> value tells Babel to only include the transforms
needed to support browsers that make up more than 0.25% of global
usage. This ensures your bundle does not contain unnecessary transpiled
code for browsers that are used by a very small percentage of users.</p>
<p>In most cases, this is a better approach than using the following
configuration:</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line">  <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token string">"last 2 versions"</span></span></code></pre>
<p>The <code>&quot;last 2 versions&quot;</code> value transpiles your code for the
<a href="http://browserl.ist/?q=last+2+versions">last two versions</a> of every browser,
which means support is provided for discontinued browsers such as Internet Explorer.
This can unnecessarily increase the size of your bundle if you do not expect these
browsers to be used to access your application.</p>
<p>Ultimately, you should select the appropriate combination of queries to only
target browsers that fit your needs.</p>
<h2 id="use-lessscript-type&quot;module&quot;greater">Use &lt;script type=&quot;module&quot;&gt; <a class="w-headline-link" href="#use-lessscript-type&quot;module&quot;greater" aria-hidden="true">#</a></h2>
<p>JavaScript modules, or ES modules, are a relatively new feature supported in
<a href="https://caniuse.com/#feat=es6-module">all major browsers</a>. You can use modules
to create scripts that can import and export from other modules, but you can
also use them with <code>@babel/preset-env</code> to only target browsers that support
them.</p>
<p>Instead of querying for specific browser versions or market share, consider
specifying <code>“esmodules” : true</code> inside your <code>.babelrc</code> file's <code>targets</code> field.</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">   <span class="token property">"presets"</span><span class="token operator">:</span><span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token punctuation">[</span></span><br><span class="highlight-line">         <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">         <span class="token punctuation">{</span></span><br><span class="highlight-line">            <span class="token property">"targets"</span><span class="token operator">:</span><span class="token punctuation">{</span></span><br><span class="highlight-line">               <span class="token property">"esmodules"</span><span class="token operator">:</span> <span class="token boolean">true</span></span><br><span class="highlight-line">            <span class="token punctuation">}</span></span><br><span class="highlight-line">         <span class="token punctuation">}</span></span><br><span class="highlight-line">      <span class="token punctuation">]</span></span><br><span class="highlight-line">   <span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>Many newer ECMAScript features compiled with Babel are already supported
in environments that support JavaScript modules. So by doing this, you
simplify the process of making sure that only transpiled code is used
for browsers that actually need it.</p>
<p>Browsers that support modules ignore scripts with a <code>nomodule</code> attribute.
Conversely, browsers that do not support modules ignore script elements with
<code>type=&quot;module&quot;</code>. This means you can include a module as well as a compiled fallback.</p>
<p>Ideally, the two version scripts of an application are included like this:</p>
<pre class="language-html"><code class="language-html"><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>main.mjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span><br><span class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nomodule</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>compiled.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span></code></pre>
<p>Browsers that support modules fetch and execute <code>main.mjs</code> and ignore <code>compiled.js</code>.
The browsers that do not support modules do the opposite.</p>
<p>If you use webpack, you can set different targets in your configurations for two
separate versions of your application:</p>
<ul>
<li>A version only for browsers that support modules.</li>
<li>A version that includes a compiled script which works in any legacy browser. This has a larger file size, since transpilation needs to support a wider range of browsers.</li>
</ul>


     

    <div class="w-post-github-link w-mt--l w-mb--l">
      <span class="w-mr--sm">
        
        Last updated: <time>Nov 5, 2018</time>
        
      </span>
      <a
        href="https://github.com/GoogleChrome/web.dev/blob/master/src/site/content/en/fast/serve-modern-code-to-modern-browsers/index.md"
      >
        Improve article
      </a>
       
    </div>

    
      <div class="w-codelabs-callout">
      <div class="w-codelabs-callout__header">
        <h2 class="w-codelabs-callout__lockup">Codelabs</h2>
        <div class="w-codelabs-callout__headline">See it in action</div>
        <div class="w-codelabs-callout__blurb">
          Learn more and put this guide into action.
        </div>
      </div>
      <ul class="w-unstyled-list w-codelabs-callout__list">
        <li class="w-codelabs-callout__listitem">
  <a
    class="w-codelabs-callout__link"
    href="/codelab-serve-modern-code/"
  >
    Serve modern code to modern browsers for faster page loads
  </a>
</li>
      </ul>
    </div>
    
  </div>

  
    
    <nav class="w-article-navigation">
  <a
    class="w-article-navigation__link w-article-navigation__link--back  gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go back"
    data-action="click"
    href="/fast"
  >
    Return to all articles
  </a>
  <a
    class="w-article-navigation__link w-article-navigation__link--forward gc-analytics-event"
    data-category="web.dev"
    data-label="navigation, go forward"
    data-action="click"
    href="/defer-non-critical-css/"
  >
    <div class="w-article-navigation__column">
      <h3 class="w-article-navigation__heading">Next article</h3>
      Defer non-critical CSS
    </div>
  </a>
</nav>
  

  
  
</div>

      </div>
    </main>
  </body>
</html>